<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QNet Dual Wallet - Your gateway to the QNet dual-network ecosystem">
    <meta name="keywords" content="QNet, wallet, blockchain, Solana, cryptocurrency, dual-network">
    <meta name="author" content="QNet Team">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        font-src 'self' data:;
        connect-src 'self' https: wss: ws:;
        worker-src 'self';
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="QNet Wallet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="./public/favicon.svg">
    <link rel="icon" type="image/x-icon" href="./public/favicon.ico">
    <link rel="apple-touch-icon" href="./public/favicon.svg">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="./src/main.js" as="script" type="module">
    <link rel="preload" href="./src/wallet/QNetDualWallet.js" as="script" type="module">
    
    <title>QNet Dual Wallet - Production Ready</title>
    
    <style>
        /* Critical CSS - Loaded inline for performance */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            overflow-x: hidden;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-logo {
            font-size: 64px;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .loading-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .loading-subtitle {
            font-size: 16px;
            color: #888;
            margin-bottom: 32px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        .loading-status {
            font-size: 14px;
            color: #ccc;
            text-align: center;
            max-width: 300px;
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin: 16px 0;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4a90e2, #357abd);
            border-radius: 2px;
            width: 0%;
            animation: progressLoad 3s ease-in-out infinite;
        }
        
        /* Error Screen */
        .error-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            text-align: center;
            padding: 20px;
        }
        
        .error-icon {
            font-size: 64px;
            color: #f44336;
            margin-bottom: 24px;
        }
        
        .error-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            color: #f44336;
        }
        
        .error-message {
            font-size: 16px;
            color: #ccc;
            margin-bottom: 24px;
            max-width: 500px;
            line-height: 1.5;
        }
        
        .error-details {
            font-size: 14px;
            color: #888;
            margin-bottom: 32px;
            font-family: 'Courier New', monospace;
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 8px;
            max-width: 600px;
            word-break: break-word;
        }
        
        .error-actions {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .error-btn {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .error-btn:hover {
            background: #357abd;
            transform: translateY(-1px);
        }
        
        .error-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .error-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Main Wallet Interface */
        #wallet-interface {
            min-height: 100vh;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        #wallet-interface.loaded {
            opacity: 1;
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes progressLoad {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .loading-logo {
                font-size: 48px;
            }
            
            .loading-title {
                font-size: 24px;
            }
            
            .error-title {
                font-size: 24px;
            }
            
            .error-actions {
                flex-direction: column;
                align-items: center;
            }
        }
        
        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            .loading-logo,
            .loading-spinner,
            .loading-progress-bar {
                animation: none;
            }
        }
        
        /* Print Styles */
        @media print {
            .loading-screen,
            .error-screen {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">üíé</div>
        <div class="loading-title">QNet Wallet</div>
        <div class="loading-subtitle">Dual-Network Architecture</div>
        <div class="loading-spinner"></div>
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
        <div class="loading-status" id="loading-status">Initializing wallet...</div>
    </div>
    
    <!-- Error Screen -->
    <div class="error-screen" id="error-screen">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title">Initialization Failed</div>
        <div class="error-message" id="error-message">
            QNet Wallet encountered an error during initialization.
        </div>
        <div class="error-details" id="error-details" style="display: none;"></div>
        <div class="error-actions">
            <button class="error-btn" onclick="window.location.reload()">
                üîÑ Reload Application
            </button>
            <button class="error-btn secondary" onclick="clearStorageAndReload()">
                üóëÔ∏è Clear Data & Reload
            </button>
            <button class="error-btn secondary" onclick="toggleErrorDetails()">
                üìã Show Details
            </button>
        </div>
    </div>
    
    <!-- Main Wallet Interface -->
    <div id="wallet-interface">
        <!-- Dynamic content will be inserted here by ProductionInterface -->
    </div>
    
    <!-- Initialization Script -->
    <script>
        // Global error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showError('JavaScript Error', event.error.message, event.error.stack);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showError('Promise Rejection', event.reason.message || event.reason, event.reason.stack);
        });
        
        // Loading status updates
        const loadingSteps = [
            'Checking browser compatibility...',
            'Loading configuration...',
            'Initializing cryptography...',
            'Connecting to networks...',
            'Setting up wallet core...',
            'Loading interface...',
            'Performing health checks...',
            'Ready!'
        ];
        
        let currentStep = 0;
        
        function updateLoadingStatus(message) {
            const statusElement = document.getElementById('loading-status');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }
        
        function nextLoadingStep() {
            if (currentStep < loadingSteps.length) {
                updateLoadingStatus(loadingSteps[currentStep]);
                currentStep++;
            }
        }
        
        // Simulate loading progress
        const loadingInterval = setInterval(nextLoadingStep, 500);
        
        // Show error screen
        function showError(title, message, details = null) {
            clearInterval(loadingInterval);
            
            const loadingScreen = document.getElementById('loading-screen');
            const errorScreen = document.getElementById('error-screen');
            const errorMessage = document.getElementById('error-message');
            const errorDetails = document.getElementById('error-details');
            
            if (loadingScreen) loadingScreen.style.display = 'none';
            if (errorScreen) errorScreen.style.display = 'flex';
            if (errorMessage) errorMessage.textContent = message;
            if (errorDetails && details) {
                errorDetails.textContent = details;
            }
        }
        
        // Toggle error details
        function toggleErrorDetails() {
            const errorDetails = document.getElementById('error-details');
            if (errorDetails) {
                errorDetails.style.display = errorDetails.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        // Clear storage and reload
        function clearStorageAndReload() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                
                // Clear IndexedDB if available
                if (window.indexedDB) {
                    indexedDB.deleteDatabase('qnet-wallet');
                }
                
                window.location.reload();
            } catch (error) {
                console.error('Failed to clear storage:', error);
                window.location.reload();
            }
        }
        
        // Hide loading screen when wallet is ready
        function hideLoadingScreen() {
            clearInterval(loadingInterval);
            
            const loadingScreen = document.getElementById('loading-screen');
            const walletInterface = document.getElementById('wallet-interface');
            
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
            
            if (walletInterface) {
                walletInterface.classList.add('loaded');
            }
        }
        
        // Listen for wallet initialization
        window.addEventListener('qnet-wallet-ready', hideLoadingScreen);
        window.addEventListener('qnet-wallet-error', (event) => {
            showError('Wallet Error', event.detail.message, event.detail.stack);
        });
        
        // Timeout fallback
        setTimeout(() => {
            if (!window.QNetWallet || !window.QNetWallet.initialized) {
                showError(
                    'Initialization Timeout',
                    'QNet Wallet took too long to initialize. This may be due to network issues or browser compatibility problems.',
                    'Try refreshing the page or clearing your browser data.'
                );
            }
        }, 30000); // 30 second timeout
        
        // Performance monitoring
        if (window.performance && window.performance.mark) {
            window.performance.mark('qnet-wallet-start');
        }
        
        // Service Worker registration (for PWA)
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
    
    <!-- Main Application -->
    <script type="module" src="./src/main.js"></script>
    
    <!-- Analytics (Production only) -->
    <script>
        // This would be replaced with actual analytics in production
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            // Production analytics code would go here
            console.log('Production analytics would be loaded here');
        }
    </script>
</body>
</html> 