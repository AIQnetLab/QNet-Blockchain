{% extends "base.html" %}
{% block title %}Blockchain Explorer - QNet{% endblock %}
{% block header %}QNet Explorer{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <form action="{{ url_for('search') }}" method="POST" class="d-flex">
                    <input class="form-control me-2" type="search" name="query" placeholder="Search by block height, transaction hash, or address" aria-label="Search">
                    <button class="btn btn-primary" type="submit">Search</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h5 class="card-title">Block Height</h5>
                <h2 class="mb-0">{{ blockchain_info.height }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h5 class="card-title">Total Transactions</h5>
                <h2 class="mb-0">{{ blockchain_info.total_transactions|default('0') }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h5 class="card-title">Total Supply</h5>
                <h2 class="mb-0">{{ blockchain_info.total_issued|int }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-light">
            <div class="card-body text-center">
                <h5 class="card-title">Pending Transactions</h5>
                <h2 class="mb-0">{{ latest_txs|length }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Latest Blocks</span>
                <a href="{{ url_for('blockchain') }}" class="btn btn-sm btn-outline-primary">View All Blocks</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Height</th>
                                <th>Time</th>
                                <th>Transactions</th>
                                <th>Producer</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for block in latest_blocks %}
                            <tr>
                                <td><a href="{{ url_for('block_detail', height=block.height) }}">{{ block.height }}</a></td>
                                <td>{{ block.time }}</td>
                                <td>{{ block.transactions }}</td>
                                <td><small class="text-muted">{{ block.producer }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Latest Transactions</span>
                <a href="{{ url_for('transactions') }}" class="btn btn-sm btn-outline-primary">View All Transactions</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Hash</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tx in latest_txs %}
                            <tr>
                                <td><a href="{{ url_for('transaction_detail', tx_hash=tx.hash) }}">{{ tx.hash[:8] }}...</a></td>
                                <td>
                                    {% if tx.sender == "network" %}
                                    <span class="badge bg-success">Coinbase</span>
                                    {% else %}
                                    <a href="{{ url_for('address_detail', address=tx.sender) }}">{{ tx.sender[:8] }}...</a>
                                    {% endif %}
                                </td>
                                <td><a href="{{ url_for('address_detail', address=tx.recipient) }}">{{ tx.recipient[:8] }}...</a></td>
                                <td>{{ tx.amount }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Network Activity
            </div>
            <div class="card-body">
                <canvas id="networkChart" height="100"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Network activity chart
var ctx = document.getElementById('networkChart').getContext('2d');
var networkChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: {{ chart_data.labels|safe }},
        datasets: [{
            label: 'Transactions',
            data: {{ chart_data.transaction_counts|safe }},
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderWidth: 1
        },
        {
            label: 'Blocks',
            data: {{ chart_data.block_counts|safe }},
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
{% endblock %}